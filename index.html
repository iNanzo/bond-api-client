<!DOCTYPE html>
<html lang="en">
<head>
  <link href="style.css" rel="stylesheet" type="text/css" />
  <meta charset="UTF-8">
  <title>Bond Web Service</title>
  <style>
    body { font-family: georgia; }
  </style>
</head>
<body>
  <h1>Bond Web Service</h1>
  <a href="year" class="category">Bond Films By Year</a><br />
  <a href="box" class="category">Bond Films By International Box Office Totals</a>
  <h3 id="filmtitle">Title Will Go Here</h3>
  <div id="films"><p>Films will go here</p></div>
  <div id="output">Results go here</div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll(".category").forEach(function (link) {
        link.addEventListener("click", function (e) {
          e.preventDefault();
          var cat = this.getAttribute("href");
          loadAJAX(cat);
        });
      });
    });

    var url = "https://newmanix.com/classes/it122/bond-web-service/";

    function loadAJAX(cat) {
      document.getElementById("output").innerHTML = "";

      var endpoint = url + "api.php?cat=" + cat;

      fetch(endpoint, {
        method: "GET",
        mode: "cors"
      })
        .then(function (response) {
          if (!response.ok) {
            throw new Error("HTTP error " + response.status);
          }
          return response.json();
        })
        .then(function (data) {
          document.getElementById("filmtitle").innerHTML = data.title;

          data.films.forEach(function (film) {
            var filmHTML = bondTemplate(film);
            document.getElementById("output").innerHTML += filmHTML;
          });
        })
        .catch(function (err) {
          document.getElementById("output").innerText = "Error loading data: " + err;
        });
    }

    function bondTemplate(film) {
      return `
        <div class="film">
          <h2>${film.Title}</h2>
          <p>Release Year - ${film.Year}</p>
          <p>James Bond - ${film.Bond}</p>
          <p>Budget - ${film.Budget}</p>
          <p>Box Office - ${film.BoxOffice}</p>
          <p>Director - ${film.Director}</p>
          <p>Producers - ${film.Producers}</p>
          <p>Writers - ${film.Writers}</p>
          <p>Composer - ${film.Composer}</p>
          <img class="pic" src="${url}/images/${film.Image}" alt="${film.Title} poster" width="100" height="100" />
        </div>
      `;
}
  </script>
</body>
</html>